<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acompanhamento Semanal</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React e ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Fontes -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- Configuração de Estilos e Impressão -->
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f3f4f6;
        }

        :root {
            --watt-dark-blue: #1e3a8a;
            --watt-blue: #2563eb;
            --watt-grey: #64748b;
            --watt-light: #f8fafc;
        }

        /* Mobile-first: Estilos base para mobile */
        .sheet {
            background: white;
            width: 100%;
            min-height: 100vh;
            margin: 0;
            padding: 16px;
            box-shadow: none;
            position: relative;
        }

        /* Desktop: Layout A4 */
        @media screen and (min-width: 768px) {
            .sheet {
                width: 210mm;
                min-height: 297mm;
                margin: 40px auto;
                padding: 20mm;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            }
        }

        /* Impressão: Formato A4 */
        @media print {
            @page {
                size: A4;
                margin: 0;
            }
            body {
                background-color: white;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .no-print {
                display: none !important;
            }
            .print-container {
                box-shadow: none;
                width: 100%;
                max-width: 100%;
                margin: 0;
                padding: 20px 40px;
                border: none;
            }
            input[type="text"], input[type="date"], textarea {
                background: white !important;
                border: 1px solid #e2e8f0;
            }
            input[type="checkbox"] {
                -webkit-print-color-adjust: exact;
            }
        }

        /* Melhorias para toque em mobile */
        @media (max-width: 767px) {
            input[type="checkbox"] {
                width: 28px !important;
                height: 28px !important;
            }
            
            button {
                padding: 12px 20px !important;
                font-size: 14px !important;
            }
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Funções Auxiliares de Validação ---

        // Valida CPF (Algoritmo padrão Receita Federal)
        const validarCPF = (cpf) => {
            cpf = cpf.replace(/[^\d]+/g, '');
            if (cpf == '') return false;
            // Elimina CPFs invalidos conhecidos
            if (cpf.length != 11 || 
                cpf == "00000000000" || 
                cpf == "11111111111" || 
                cpf == "22222222222" || 
                cpf == "33333333333" || 
                cpf == "44444444444" || 
                cpf == "55555555555" || 
                cpf == "66666666666" || 
                cpf == "77777777777" || 
                cpf == "88888888888" || 
                cpf == "99999999999")
                    return false;
            
            let add = 0;
            for (let i = 0; i < 9; i ++) add += parseInt(cpf.charAt(i)) * (10 - i);
            let rev = 11 - (add % 11);
            if (rev == 10 || rev == 11) rev = 0;
            if (rev != parseInt(cpf.charAt(9))) return false;
            
            add = 0;
            for (let i = 0; i < 10; i ++) add += parseInt(cpf.charAt(i)) * (11 - i);
            rev = 11 - (add % 11);
            if (rev == 10 || rev == 11) rev = 0;
            if (rev != parseInt(cpf.charAt(10))) return false;
            
            return true;
        };

        // Formata CPF visualmente
        const mascaraCPF = (value) => {
            return value
                .replace(/\D/g, '')
                .replace(/(\d{3})(\d)/, '$1.$2')
                .replace(/(\d{3})(\d)/, '$1.$2')
                .replace(/(\d{3})(\d{1,2})/, '$1-$2')
                .replace(/(-\d{2})\d+?$/, '$1');
        };

        // Capitaliza nomes (Ex: joão silva -> João Silva)
        const formatarNome = (nome) => {
            return nome.toLowerCase().replace(/(?:^|\s)\S/g, function(a) { 
                return a.toUpperCase(); 
            });
        };

        const ChecklistApp = () => {
            // Estado do Formulário
            const [formData, setFormData] = useState({
                nome: '',
                cargo: '',
                cpf: '',
                dataInicio: '',
                dataFim: '',
                dificuldades: ''
            });

            // Estado para feedback visual imediato
            const [cpfInvalid, setCpfInvalid] = useState(false);
            const [nomeInvalid, setNomeInvalid] = useState(false);
            const [dataFimInvalid, setDataFimInvalid] = useState(false);
            const [dataFimErrorMsg, setDataFimErrorMsg] = useState('');

            // Estado para limites de data
            const [dataLimites, setDataLimites] = useState({
                minFim: '',
                maxFim: ''
            });

            // Estado das Tarefas
            const [tasks, setTasks] = useState([
                { id: 1, text: '', selected: false },
                { id: 2, text: '', selected: false },
                { id: 3, text: '', selected: false },
                { id: 4, text: '', selected: false },
            ]);

            const [errors, setErrors] = useState([]);

            // Atualiza limites de data quando Data Inicio muda
            useEffect(() => {
                if (formData.dataInicio) {
                    const inicio = new Date(formData.dataInicio);
                    
                    // Minimo: Data Fim não pode ser menor que Inicio
                    const minDate = formData.dataInicio;

                    // Máximo: Data Fim deve ser no máximo Inicio + 7 dias
                    const maxDateObj = new Date(inicio);
                    maxDateObj.setDate(inicio.getDate() + 7); // Adiciona 7 dias
                    const maxDate = maxDateObj.toISOString().split('T')[0];

                    setDataLimites({ minFim: minDate, maxFim: maxDate });

                    // Se a data fim atual estiver fora do novo range, reseta
                    if (formData.dataFim) {
                        if (formData.dataFim < minDate || formData.dataFim > maxDate) {
                            setFormData(prev => ({ ...prev, dataFim: '' }));
                        }
                    }
                } else {
                    setDataLimites({ minFim: '', maxFim: '' });
                }
            }, [formData.dataInicio]);

            // Manipular inputs gerais
            const handleInputChange = (e) => {
                let { name, value } = e.target;

                // Aplica formatação específica
                if (name === 'cpf') {
                    value = mascaraCPF(value);
                    if (cpfInvalid) setCpfInvalid(false);
                }
                if (name === 'nome') {
                    value = formatarNome(value);
                    if (nomeInvalid) setNomeInvalid(false);
                }

                // Validação de Data Fim em tempo real
                if (name === 'dataFim') {
                    if (dataFimInvalid) {
                        setDataFimInvalid(false);
                        setDataFimErrorMsg('');
                    }
                    
                    // Valida apenas se houver valor e data de início
                    if (value && formData.dataInicio) {
                        const inicio = new Date(formData.dataInicio);
                        const fim = new Date(value);
                        const diffTime = Math.abs(fim - inicio);
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                        if (fim < inicio) {
                            setDataFimInvalid(true);
                            setDataFimErrorMsg('Data fim não pode ser anterior à data início');
                        } else if (diffDays > 7) {
                            setDataFimInvalid(true);
                            setDataFimErrorMsg('Período máximo é de 7 dias');
                        }
                    }
                }

                setFormData(prev => ({ ...prev, [name]: value }));
            };

            // Valida Data Fim ao sair do campo (onBlur)
            const handleDataFimBlur = () => {
                if (formData.dataFim && formData.dataInicio) {
                    const inicio = new Date(formData.dataInicio);
                    const fim = new Date(formData.dataFim);
                    const diffTime = Math.abs(fim - inicio);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                    if (fim < inicio) {
                        setDataFimInvalid(true);
                        setDataFimErrorMsg('Data fim não pode ser anterior à data início');
                    } else if (diffDays > 7) {
                        setDataFimInvalid(true);
                        setDataFimErrorMsg('Período máximo é de 7 dias');
                    } else {
                        setDataFimInvalid(false);
                        setDataFimErrorMsg('');
                    }
                }
            };

            // Valida CPF ao sair do campo (onBlur)
            const handleCpfBlur = () => {
                if (formData.cpf && !validarCPF(formData.cpf)) {
                    setCpfInvalid(true);
                } else {
                    setCpfInvalid(false);
                }
            };

            // Valida Nome ao sair do campo (onBlur)
            const handleNomeBlur = () => {
                const nomes = formData.nome.trim().split(/\s+/);
                if (formData.nome && nomes.length < 2) {
                    setNomeInvalid(true);
                } else {
                    setNomeInvalid(false);
                }
            };

            // Manipular tarefas
            const handleTaskChange = (id, field, value) => {
                const newTasks = tasks.map(task => {
                    if (task.id === id) {
                        return { ...task, [field]: value };
                    }
                    return task;
                });
                setTasks(newTasks);
            };

            // Validação
            const validate = () => {
                const newErrors = [];
                
                // 1. Campos de cabeçalho
                if (!formData.nome) {
                    newErrors.push("Nome é obrigatório.");
                } else if (formData.nome.trim().split(/\s+/).length < 2) {
                    newErrors.push("Preencha o Nome Completo (Nome e Sobrenome).");
                }

                if (!formData.cargo) newErrors.push("Cargo é obrigatório.");
                
                // Validação CPF
                if (!formData.cpf) {
                    newErrors.push("CPF é obrigatório.");
                } else if (!validarCPF(formData.cpf)) {
                    newErrors.push("CPF inválido. Verifique os números.");
                }

                // Validação Datas
                if (!formData.dataInicio || !formData.dataFim) {
                    newErrors.push("As datas de Início e Fim são obrigatórias.");
                } else {
                    const inicio = new Date(formData.dataInicio);
                    const fim = new Date(formData.dataFim);
                    const diffTime = Math.abs(fim - inicio);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 

                    if (fim < inicio) {
                        newErrors.push("A data final não pode ser anterior à data inicial.");
                    }
                    if (diffDays > 7) {
                        newErrors.push("O período não pode exceder 7 dias (tarefa semanal).");
                    }
                }

                // 2. Preencher todas as 4 caixas de texto
                const emptyTasks = tasks.filter(t => t.text.trim() === '');
                if (emptyTasks.length > 0) {
                    newErrors.push("Todas as 4 opções de tarefas devem ser descritas.");
                }

                // 3. Marcar no mínimo 2 opções
                const selectedCount = tasks.filter(t => t.selected).length;
                if (selectedCount < 2) {
                    newErrors.push("Selecione pelo menos 2 tarefas para realizar esta semana.");
                }

                setErrors(newErrors);
                return newErrors.length === 0;
            };

            const handlePrint = () => {
                if (validate()) {
                    window.print();
                } else {
                    alert("Atenção! Verifique os erros no topo da página antes de imprimir.");
                }
            };

            return (
                <div className="min-h-screen pb-10">
                    {/* Barra Superior */}
                    <div className="no-print bg-blue-900 text-white p-3 md:p-4 shadow-md mb-4 md:mb-6">
                        <div className="max-w-4xl mx-auto flex flex-col sm:flex-row justify-between items-center gap-3">
                            <h1 className="text-lg md:text-xl font-bold">Gerador de Lista Semanal</h1>
                            <button 
                                onClick={handlePrint}
                                className="w-full sm:w-auto bg-green-500 hover:bg-green-600 text-white font-bold py-3 md:py-2 px-6 rounded shadow transition duration-200 flex items-center justify-center gap-2"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
                                </svg>
                                Baixar PDF / Imprimir
                            </button>
                        </div>
                    </div>

                    {/* Mensagem de Erro */}
                    {errors.length > 0 && (
                        <div className="no-print max-w-4xl mx-auto mb-4 bg-red-100 border-l-4 border-red-500 text-red-700 p-3 md:p-4 rounded shadow animate-pulse">
                            <p className="font-bold text-sm md:text-base">Erros encontrados:</p>
                            <ul className="list-disc pl-5 text-sm">
                                {errors.map((erro, i) => <li key={i}>{erro}</li>)}
                            </ul>
                        </div>
                    )}

                    {/* Folha A4 */}
                    <div className="sheet print-container">
                        
                        {/* Cabeçalho */}
                        <div className="flex flex-col md:flex-row justify-between items-start md:items-start mb-6 md:mb-8 border-b-4 border-blue-900 pb-3 md:pb-4 gap-3 md:gap-0">
                            <div>
                                <div className="flex flex-col">
                                    <h1 className="text-3xl md:text-4xl font-black tracking-tighter text-blue-900 leading-none">
                                        WATT
                                    </h1>
                                    <span className="text-xs md:text-sm font-semibold tracking-widest text-gray-500 uppercase">
                                        Consultoria
                                    </span>
                                </div>
                            </div>
                            <div className="text-left md:text-right">
                                <h2 className="text-xl md:text-2xl font-bold text-gray-800">Acompanhamento Semanal</h2>
                                <p className="text-xs md:text-sm text-gray-500">Controle Gerencial</p>
                            </div>
                        </div>

                        {/* Dados do Colaborador */}
                        <div className="bg-gray-50 p-3 md:p-4 rounded-lg border border-gray-200 mb-6 md:mb-8">
                            <h3 className="text-blue-900 font-bold mb-3 border-b border-gray-300 pb-1 uppercase text-xs tracking-wider">Dados do Colaborador</h3>
                            <div className="grid grid-cols-1 md:grid-cols-12 gap-3 md:gap-4">
                                <div className="md:col-span-8">
                                    <label className="block text-gray-600 text-xs font-bold mb-1">Nome Completo</label>
                                    <input 
                                        type="text" 
                                        name="nome"
                                        value={formData.nome}
                                        onChange={handleInputChange}
                                        onBlur={handleNomeBlur}
                                        className={`w-full bg-white border rounded px-3 py-2 md:px-2 md:py-1 text-gray-800 focus:outline-none focus:border-blue-500 capitalize ${nomeInvalid ? 'border-red-500' : 'border-gray-300'}`}
                                        placeholder="Digite seu nome"
                                    />
                                    {nomeInvalid && <p className="text-red-500 text-[10px] font-bold mt-1">Insira Nome e Sobrenome</p>}
                                </div>
                                <div className="md:col-span-4">
                                    <label className="block text-gray-600 text-xs font-bold mb-1">CPF</label>
                                    <input 
                                        type="text" 
                                        name="cpf"
                                        value={formData.cpf}
                                        onChange={handleInputChange}
                                        onBlur={handleCpfBlur}
                                        maxLength="14"
                                        className={`w-full bg-white border rounded px-3 py-2 md:px-2 md:py-1 text-gray-800 focus:outline-none focus:border-blue-500 ${cpfInvalid || errors.some(e => e.includes('CPF')) ? 'border-red-500' : 'border-gray-300'}`}
                                        placeholder="000.000.000-00"
                                    />
                                    {cpfInvalid && <p className="text-red-500 text-[10px] font-bold mt-1">CPF Inválido</p>}
                                </div>
                                <div className="md:col-span-6">
                                    <label className="block text-gray-600 text-xs font-bold mb-1">Cargo/Função</label>
                                    <input 
                                        type="text" 
                                        name="cargo"
                                        value={formData.cargo}
                                        onChange={handleInputChange}
                                        className="w-full bg-white border border-gray-300 rounded px-3 py-2 md:px-2 md:py-1 text-gray-800 focus:outline-none focus:border-blue-500"
                                        placeholder="Ex: Consultor de Projetos"
                                    />
                                </div>
                                <div className="md:col-span-3">
                                    <label className="block text-gray-600 text-xs font-bold mb-1">Data Início</label>
                                    <input 
                                        type="date" 
                                        name="dataInicio"
                                        value={formData.dataInicio}
                                        onChange={handleInputChange}
                                        className="w-full bg-white border border-gray-300 rounded px-3 py-2 md:px-2 md:py-1 text-gray-800 text-sm focus:outline-none focus:border-blue-500"
                                    />
                                </div>
                                <div className="md:col-span-3">
                                    <label className="block text-gray-600 text-xs font-bold mb-1">Data Fim</label>
                                    <input 
                                        type="date" 
                                        name="dataFim"
                                        value={formData.dataFim}
                                        min={dataLimites.minFim}
                                        max={dataLimites.maxFim}
                                        disabled={!formData.dataInicio}
                                        onChange={handleInputChange}
                                        onBlur={handleDataFimBlur}
                                        className={`w-full bg-white border rounded px-3 py-2 md:px-2 md:py-1 text-gray-800 text-sm focus:outline-none focus:border-blue-500 disabled:bg-gray-200 disabled:text-gray-400 ${dataFimInvalid ? 'border-red-500' : 'border-gray-300'}`}
                                        title={!formData.dataInicio ? "Selecione a Data de Início primeiro" : "Máximo 7 dias após o início"}
                                    />
                                    {dataFimInvalid && <p className="text-red-500 text-[10px] font-bold mt-1">{dataFimErrorMsg}</p>}
                                </div>
                            </div>
                        </div>

                        {/* Seção de Tarefas */}
                        <div className="mb-6 md:mb-8">
                            <div className="flex flex-col sm:flex-row justify-between items-start sm:items-end mb-2 border-b border-gray-300 pb-1 gap-1">
                                <h3 className="text-blue-900 font-bold uppercase text-xs tracking-wider">
                                    Definição de Metas/Tarefas
                                </h3>
                                <span className="text-xs text-gray-500 italic no-print">
                                    (Preencha as 4 opções, marque pelo menos 2)
                                </span>
                            </div>
                            
                            <div className="space-y-3 md:space-y-4">
                                {tasks.map((task) => (
                                    <div key={task.id} className={`flex flex-col sm:flex-row items-start gap-3 md:gap-4 p-3 rounded border transition-colors ${task.selected ? 'bg-blue-50 border-blue-200' : 'bg-white border-gray-200'}`}>
                                        <div className="flex items-center sm:flex-col sm:items-center justify-start sm:justify-center gap-2 sm:gap-0 sm:pt-2 w-full sm:w-auto">
                                            <input 
                                                type="checkbox" 
                                                checked={task.selected}
                                                onChange={(e) => handleTaskChange(task.id, 'selected', e.target.checked)}
                                                className="w-6 h-6 text-blue-900 rounded focus:ring-blue-500 cursor-pointer flex-shrink-0"
                                            />
                                            <span className="text-[10px] text-gray-400 sm:mt-1 uppercase font-bold">
                                                {task.selected ? 'Ativa' : 'Opcional'}
                                            </span>
                                        </div>
                                        <div className="flex-grow w-full">
                                            <label className="block text-gray-700 text-xs font-bold mb-1">
                                                Opção de Tarefa {task.id}
                                            </label>
                                            <input 
                                                type="text" 
                                                value={task.text}
                                                onChange={(e) => handleTaskChange(task.id, 'text', e.target.value)}
                                                className="w-full bg-transparent border-b border-gray-300 py-1 md:py-1 text-gray-800 focus:outline-none focus:border-blue-500 placeholder-gray-300 transition-colors"
                                                placeholder={`Descreva a tarefa ${task.id} aqui...`}
                                            />
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Seção de Dificuldades */}
                        <div className="mb-6 md:mb-8 flex-grow">
                            <h3 className="text-blue-900 font-bold mb-2 border-b border-gray-300 pb-1 uppercase text-xs tracking-wider">
                                Dificuldades Previstas / Observações
                            </h3>
                            <div className="relative">
                                <textarea 
                                    name="dificuldades"
                                    value={formData.dificuldades}
                                    onChange={handleInputChange}
                                    className="w-full h-32 md:h-40 p-3 md:p-4 border border-gray-300 rounded bg-gray-50 text-gray-800 text-sm focus:outline-none focus:border-blue-500 resize-none"
                                    placeholder="Descreva aqui as dificuldades que você antecipa para realizar as tarefas selecionadas ou observações importantes sobre a semana..."
                                ></textarea>
                            </div>
                        </div>

                        {/* Rodapé de Assinatura (Aparece na impressão) */}
                        <div className="mt-8 md:mt-12 pt-6 md:pt-8 border-t border-gray-300 grid grid-cols-1 sm:grid-cols-2 gap-8 md:gap-12">
                            <div className="text-center">
                                <div className="border-b border-black mb-2 h-8"></div>
                                <p className="text-xs uppercase font-bold text-gray-600">Assinatura do Colaborador</p>
                                <p className="text-[10px] text-gray-400">
                                    {formData.dataInicio ? new Date(formData.dataInicio).toLocaleDateString('pt-BR') : '__/__/____'}
                                </p>
                            </div>
                            <div className="text-center">
                                <div className="border-b border-black mb-2 h-8"></div>
                                <p className="text-xs uppercase font-bold text-gray-600">Visto da Gerência</p>
                                <p className="text-[10px] text-gray-400">Watt Consultoria</p>
                            </div>
                        </div>

                    </div>
                    
                    <div className="no-print text-center text-gray-500 text-sm mt-4">
                        <p>© Watt Consultoria - Produzido por Julius Romanzeira</p>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ChecklistApp />);
    </script>
</body>
</html>
